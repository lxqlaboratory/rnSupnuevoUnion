<!DOCTYPE html><html><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf8" />    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />    <title>超市地理</title>    <style type="text/css">        body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}        #l-map{height:100%;width:100%;}    </style>    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=mzyj6b1FMeo9iYELIooCHtkGWKs7pyCa"></script></head><body><div id="l-map"></div></body></html><script type="text/javascript">    const POI = 1;    const SEARCH = 2;    const PAN = 3;    var map = new BMap.Map("l-map");    var center = new BMap.Point(-58.49897375,-34.522105);    map.centerAndZoom(center, 15);    var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件    map.addControl(top_left_navigation);    var opts = {        width : 200,     // 信息窗口宽度        height: 100,     // 信息窗口高度        title : "Address" , // 信息窗口标题        enableMessage:true,//设置允许信息窗发送短息    }    //存储所有坐标    var adds = [];    window.onload = function() {        document.addEventListener('message', function(e) {            var msg = JSON.parse(e.data);            switch(msg.command){                case POI:_showPoiMarkers(msg.data);break;                case SEARCH:_poiSearch(msg.data);break;                case PAN:_panMarker(msg.data);break;            }        });    }    function _showPoiMarkers(sups){        map.clearOverlays();        for(var i = 0; i<sups.length; i++){            var sup = sups[i];            var sup_point = new BMap.Point(sup.lng,sup.lat);            var sup_infoWindow = new BMap.InfoWindow(sup.address, opts);            addMarkerWithWindow(sup_point,sup_infoWindow);            if(i == sups.length-1){                setTimeout(function () {                    setAdapterZoom(adds);                }, 1000)}        }    }    function addMarkerWithWindow(point,infoWindow){        var marker = new BMap.Marker(point);        map.addOverlay(marker);        marker.addEventListener("click", function(){            map.openInfoWindow(infoWindow,point); //开启信息窗口        });        adds.push(point);    }    function _poiSearch(text){        var options = {            onSearchComplete: function(results){                if (local.getStatus() == BMAP_STATUS_SUCCESS){                    var poiList = [];                    for (var i = 0; i < results.getCurrentNumPois(); i ++){                        var poi = results.getPoi(i);                        poiList.push(poi);                    }                    sendData(SEARCH,poiList);                }            }        };        var local = new BMap.LocalSearch(map, options);        local.search(text);    }    function _panMarker(poiInfo) {        map.clearOverlays();        adds = [];        var poi_point = poiInfo.point;        var poi_infoWindow = new BMap.InfoWindow(poiInfo.address, opts);        addMarkerWithWindow(poi_point,poi_infoWindow);        setTimeout(function () {            setAdapterZoom(adds);        }, 1000)    }    function sendData(command,data) {        if (window.originalPostMessage) {            window.postMessage(JSON.stringify({command:command,data:data}));        } else {            throw Error('postMessage接口还未注入');        }    }    function setAdapterZoom(adds) {        var view = map.getViewport(eval(adds));        var mapZoom = view.zoom;        var centerPoint = view.center;        map.centerAndZoom(centerPoint, mapZoom);    }    function attribute(e){        var p = e.target;  //获取marker的位置        var position = p.getPosition()        var lng = position.lng;        var lat = position.lat;        var plateNum = p.getTitle();    }</script>