<!DOCTYPE html><html><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf8" />    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />    <title>超市地理</title>    <style type="text/css">        body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}        #m-map{height:100%;width:100%;}    </style>    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&setLang=es&key=Aneruoa_wn-X2HYWgq-io8gRh_hkFilwZKUPJK5PILih2ks4udljMHPoX73fJqcN'></script></head><body><div id="m-map"></div></body></html><script type="text/javascript">    const POI = 1;    const CLICK = 4;    var map;    var currInfobox;    function GetMap() {        map = new Microsoft.Maps.Map('#m-map', {            center: new Microsoft.Maps.Location( -34.542982, -58.493737),            zoom: 12        });        currInfobox = new Microsoft.Maps.Infobox(map.getCenter(), {            visible: false        });        currInfobox.setMap(map);    }    window.onload = function () {        document.addEventListener('message', function (e) {            var msg = (JSON.parse(e.data));            var merchants = msg.data.merchants;            var edges = msg.data.edges;            switch (msg.command) {                case POI:                    _showPoiMarkers(merchants, edges);                    break;                case SEARCH:                    _poiSearch(msg.data);                    break;                case PAN:                    _panMarker(msg.data);                    break;            }        });    }    function _showPoiMarkers(merchants, edges){        for(var i = 0; i<merchants.length; i++){            var merchant = merchants[i];            var merchant_point = new Microsoft.Maps.Location(merchant.latitude,merchant.longitude);            var merchant_pin = new Microsoft.Maps.Pushpin(merchant_point,{title:merchant.nubre});            merchant_pin.metadata = {title:merchant.nubre}            Microsoft.Maps.Events.addHandler(merchant_pin, 'click', _showAndPostPinInfo);            map.entities.push(merchant_pin);        }        _MoveToTheCenter(edges)    }    function _poiSearch(poiInfo) {    }    function _panMarker() {    }    function _showAndPostPinInfo(e) {        if (e.target.metadata) {            var pin = e.target;            // show pinInfo            currInfobox.setOptions({                location: pin.getLocation(),                title: pin.metadata.title,                visible: true            });            // post pinInfo            var pinInfo = {latitude:pin.getLocation().latitude,longitude:pin.getLocation().longitude,title:pin.metadata.title};            sendData(CLICK,pinInfo);        }    }    function sendData(command,data) {        if (window.originalPostMessage) {            var message = JSON.stringify({command:command,data:data});            window.postMessage(message);        } else {            throw Error('postMessage接口还未注入');        }    }    function _MoveToTheCenter(edges) {        var center_lat = 0;        var center_lng = 0;        for(var i = 0; i<edges.length; i++){            center_lat += edges.latitude;            center_lng = edges.longitude;        }        map.setView({            center: new Microsoft.Maps.Location( center_lat, center_lng),            zoom: 12        });    }</script>